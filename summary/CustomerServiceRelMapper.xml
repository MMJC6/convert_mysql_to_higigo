<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.starso.job.modules.summary.mapper.CustomerServiceRelMapper">
    
    <resultMap type="com.starso.system.api.domain.SCustomerServiceRel" id="CustomerServiceRelResult">
        <result property="id"    column="id"    />
        <result property="customerId"    column="customer_id"    />
        <result property="serviceId"    column="service_id"    />
        <result property="startTime"    column="start_time"    />
        <result property="endTime"    column="end_time"    />
        <result property="openState"    column="open_state"    />
        <result property="status"    column="status"    />
        <result property="createId"    column="create_id"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateId"    column="update_id"    />
        <result property="updateTime"    column="update_time"    />
        <result property="type"    column="type"    />
        <result property="num"    column="num"    />
        <result property="nums"    column="nums"    />
        <result property="count"    column="count"    />
    </resultMap>

    <sql id="selectCustomerServiceRelVo">
        select id, customer_id, service_id, start_time, end_time, open_state, status, create_id, create_time, update_id, update_time, type, num, nums, count from s_customer_service_rel
    </sql>

    <select id="selectCustomerServiceRelList" parameterType="com.starso.system.api.domain.SCustomerServiceRel" resultMap="CustomerServiceRelResult">
        SELECT r.id, r.customer_id, r.service_id, r.start_time, r.end_time, r.open_state, r.type, r.num, r.nums, r.count, it.name AS serviceName
        FROM  global_service_item it,s_customer_service_rel 	 r
				where  r.status = '1' AND r.customer_id = #{customerId} and r.open_state='1'
				and it.status = '1'  and it.parent_id!='0' and r.service_id=it.id
    </select>
    
    <select id="selectCustomerServiceRelById" parameterType="String" resultMap="CustomerServiceRelResult">
        <include refid="selectCustomerServiceRelVo"/>
        where id = #{id}
    </select>
        
    <insert id="insertCustomerServiceRel" parameterType="com.starso.system.api.domain.SCustomerServiceRel">
        insert into s_customer_service_rel
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="customerId != null">customer_id,</if>
            <if test="serviceId != null">service_id,</if>
            <if test="startTime != null">start_time,</if>
            <if test="endTime != null">end_time,</if>
            <if test="openState != null">open_state,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="createId != null">create_id,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateId != null">update_id,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="type != null">type,</if>
            <if test="num != null">num,</if>
            <if test="nums != null">nums,</if>
            <if test="count != null">count,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="customerId != null">#{customerId},</if>
            <if test="serviceId != null">#{serviceId},</if>
            <if test="startTime != null">#{startTime},</if>
            <if test="endTime != null">#{endTime},</if>
            <if test="openState != null">#{openState},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="createId != null">#{createId},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateId != null">#{updateId},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="type != null">#{type},</if>
            <if test="num != null">#{num},</if>
            <if test="nums != null">#{nums},</if>
            <if test="count != null">#{count},</if>
         </trim>
    </insert>

    <update id="updateCustomerServiceRel" parameterType="com.starso.system.api.domain.SCustomerServiceRel">
        update s_customer_service_rel
        <trim prefix="SET" suffixOverrides=",">
            <if test="customerId != null">customer_id = #{customerId},</if>
            <if test="serviceId != null">service_id = #{serviceId},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="openState != null">open_state = #{openState},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="createId != null">create_id = #{createId},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateId != null">update_id = #{updateId},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="type != null">type = #{type},</if>
            <if test="num != null">num = #{num},</if>
            <if test="nums != null">nums = #{nums},</if>
            <if test="count != null">count = #{count},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteCustomerServiceRelById" parameterType="String">
        delete from s_customer_service_rel where id = #{id}
    </delete>

    <delete id="deleteCustomerServiceRelByIds" parameterType="String">
        delete from s_customer_service_rel where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <insert id="insertList" parameterType="com.starso.system.api.domain.SCustomerServiceRel">
        insert into s_customer_service_rel (id,service_id,open_state,update_id,create_id,type,num,nums,count,start_time,end_time)
        values
        <foreach collection="sSCustomerServiceRelDataList" item="item" separator=",">
            (#{item.id},#{item.serviceId},#{item.openState},#{item.updateId},#{item.createId},#{item.type},#{item.num},#{item.nums},#{item.count},#{item.startTime,jdbcType=TIMESTAMP},#{item.endTime,jdbcType=TIMESTAMP})
        </foreach>
    </insert>

    <delete id="deleteAllData">
        delete from s_customer_service_rel
    </delete>
</mapper>